//***********************************************************//
//Autocomplete search plugin for basic JSON v1.0 - 02/02/2019
//Hisham Tajeddine - hisham.tj@gmail.com
//***********************************************************//
function loadResults(filteredJson, settings) { if ($(settings.resultsHolder).find(".resultsList").remove(), null != filteredJson && filteredJson.length > 0) { var list = $(settings.resultsHolder).append("<ul class='resultsList'></ul>").find("ul"); $.each(filteredJson, function (e, s) { var t, r; t = s[settings.resultJsonTextField], r = s[settings.resultJsonValueField], list.append("<li><a data-value='" + r + "'>" + t + "</a></li>") }), $(settings.resultsHolder).find(".resultsList li a").click(function () { settings.resultClickFunctionName || (settings.resultClickFunctionName = "customClickFunction"); var clickFunction = settings.resultClickFunctionName + "($(this));"; eval(clickFunction) }), $(settings.resultsHolder).find(".resultsList li:first-child").addClass("selected"), $(settings.resultsHolder).find(".resultsList li").on("mouseover", function () { $(this).siblings().removeClass("selected"), $(this).addClass("selected") }) } else throwError(settings.noResultsMessage, settings, "noresults"); settings.showLoader && $(settings.loaderHolder).find(".loader").remove() } function throwError(e, s, t) { s.messageAlert ? alert(e) : s.messageHolder && ($(s.messageHolder).html(e), $(s.messageHolder).addClass("message " + ("error" == t ? "error" : "noResults"))) } $.fn.autocomplete = function (e) { this.wrap("<div class='searchHolder'></div>"); var s = $.extend({ dataSource: "sample.json", dataSourceAllowCache: !1, dataParameterName: "", minimumCharacters: 3, resultsHolder: ".searchHolder", noResultsMessage: "No results", errorMessage: "An error has occurred", messageAlert: !0, messageHolder: null, showLoader: !0, loaderHolder: ".searchHolder", resultJsonTextField: "name", resultJsonValueField: "id", resultClickFunctionName: "customClickFunction" }, e); return this.keyup(function (e) { if (38 != e.keyCode && 40 != e.keyCode && 13 != e.keyCode && e.keyCode != 39 && e.keyCode != 37) if (s.dataSource && s.dataSource.length > 0) if (s.resultJsonTextField && s.resultJsonTextField.length > 0 && s.resultJsonValueField && s.resultJsonValueField.length > 0) { var t = $(this).val(); $(s.resultsHolder) || (s.resultsHolder = $(this).parent()), t.length >= s.minimumCharacters ? (s.showLoader && (s.loaderHolder || (s.loaderHolder = $(this).parent()), $(s.loaderHolder).addClass("loaderHolder"), $(s.loaderHolder).prepend("<div class='loader'></div>")), $.ajaxSetup({ cache: s.dataSourceAllowCache }), s.dataSource.toLowerCase().indexOf(".json") > -1 ? $.ajax({ url: s.dataSource, dataType: "json", success: function (e) { loadResults($(e).filter(function (e, r) { return r[s.resultJsonTextField].indexOf(t) > -1 }), s) }, error: function (e) { throwError(e.responseText, s, "error") } }) : s.dataParameterName && s.dataParameterName.length > 0 ? $.ajax({ url: s.dataSource, type: "GET", contentType: "application/json; charset=utf-8", data: s.dataParameterName + "=" + t, success: function (e) { loadResults(JSON.parse(e), s) }, error: function (e) { throwError(e.responseText, s, "error") } }) : alert("No search query parameter name is defined")) : $(s.resultsHolder).find(".resultsList").remove() } else alert("No JSON text &/or value field is defined"); else alert("No JSON data source is defined"); else { if ($(this).parent().find(".resultsList li").length > 1) { if (38 == e.keyCode) { var r = $(this).parent().find(".resultsList li.selected"); $(this).parent().find(".resultsList li").removeClass("selected"), 0 == r.prev().length ? r.siblings().last().addClass("selected") : r.prev().addClass("selected") } if (40 == e.keyCode) { r = $(this).parent().find(".resultsList li.selected"); $(this).parent().find(".resultsList li").removeClass("selected"), 0 == r.next().length ? r.siblings().first().addClass("selected") : r.next().addClass("selected") } } 13 == e.keyCode && $(this).parent().find(".resultsList li.selected a").click() } }) };